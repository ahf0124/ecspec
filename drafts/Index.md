# ECとは
事業者がオンラインで販売を行い、顧客が決済し、指定の配送先に商品を送る、もしくはサービスを提供する一連のやり取りをEC(Electric Commerce)と呼ぶ。上記の前段階(集客やマーケティング)、後段階も含めて業務範囲は日々大きくなっている。
商品、顧客、注文、物流が主要な要素で、それぞれの仕様を詰めることによって、安定した質の良いECサイトを作る事が可能であるとともに全体的な事業改善、業務改善を行うことが可能である。

***

# 受注ステータスフロー
顧客が商品を購入した後に発生する一連の受注業務フローを受注ステータスフローと呼ぶ。
ECにおける主要な業務が発生するフローとなる。
顧客が注文した内容は、ステータスが「受注」「引当」「出荷指示」「出荷」「着荷」「計上」遷移していく形となる。
また、このステータスに応じて、入金を確認したり、決済を確定させたり、配送会社における送り状の番号を送ったり、ポイントを付与したり「業務」が発生していく。
この「業務」は業態や業種によって、EC事業の体制や作業者の割り当てによって異なる。
一般的な例をもとに、あるべき業務フローを検討するのが良い。

一般的でシンプルなフローをベースに紹介する。
「画像」

## 注文確認
- 注文を受け付けて問題ないかを確認する。
- 注文情報の確認は誰か人力で行うかどうか。
- 例えば、備考にお客様が入力した情報を確認せずにWMS側に流す？キャンセルできる？

- 離島や特定住所の場合は、そもそも送付して問題ないか、送料の再計算が必要かなどを調整する必要がある。
- ブラックリストにあたるユーザーからの注文の場合は、内容を確認する場合がある。
- 上記いずれにも当たらない場合は、自動で次のステータスに移動するなども可能である。

### 受注分割
- 受注後に注文を分割することもある。(配送日が違う、発送元が違う)


## 発注
発注が必要な場合は、発注処理を行う。発注をEDIもしくはFAXなどで自動連係することも多い。
メーカーに発注して、メーカーから直送するようなケースも存在するし、メーカーからの商品を一度倉庫に集めて配送するケースも存在する。


## 入金確認
入金確認は、その方法によって連携や確認方法が異なる。
自動化することによって、業務効率を上げることが可能。

### 入金確認(クレジットカード)
- 利用されたクレジットカード情報、利用者情報が問題ないか確認する。
- これまで不正に利用されていないかなど、外部サービスを利用して確認することもある。

### 入金確認(銀行振込)
- 銀行振込は銀行に入金があったかを確認する必要がある
- 仮想口座を使うと、入金と口座が１：１で紐づくので、API経由などで自動で入金処理することが可能。
- 仮想口座の場合は、番号が使いまわしとなっている。

### 入金確認(NP後払い)
- 後払いサービスに該当注文を連携して与信が下りるかどうか確認する
- 確認は、カート時点からリアルタイム与信を行うようなことも可能である

### 入金確認(Amazonペイメント)

- 主なメリットとして、Amazonに登録されている住所を利用する場合、保証がある。
- より詳細なAmazonペイメントの情報については後述する。


## 在庫引当とは
ECサイトで物が売れたからといって、直接商品が確保され、そのまま配送に回されるわけではない。
商品は実際には、倉庫の棚にある。注文データを倉庫に渡すことによって出荷可能な商品を確保し、
注文(お客様、配送先)と紐づけ、出荷指示につなげる必要がある。
規模が大きくなると倉庫も複数になるので、どの倉庫で引当てて、どの配送会社で送るかなど
業務の規模が複雑になる傾向がある。

## 出荷後の返品オペレーション


*** 

# 注文
相手を識別する。会員があればログイン、配送先や方法の選択、支払い方法の選択、上記に含まれないオプションの選択を行う。
それぞれに多様な要件がある。

## 会員、ゲスト購入
- 購入には会員登録が必須か、ゲスト購入も可能とするか
- ゲスト購入後に会員登録するような仕様を設けるか

## カートイン
- カートインのタイミングで料金の計算や配達日指定のルールなどが決めることもあり、行う処理は多い。
- 同じカートに同梱不可能な商品(セット購入不能な商品、例えば常温商品と冷凍商品)をチェックする



## 支払い方法
### クレジットカード
- クレジットカード決済を提供する決済事業者は複数社あり、決済事業者の選択は、多くの場合料率(注文金額に対する手数料)で決まることが多い。それ以外の要素だと機能的なもので決まることもある。
- よく聞く決済事業者としては(GMO、Veritrans、SoftBankPayment、Paygent、BlueGate)などがある。
- クレカ登録については2018年3月より、PCI DSS を保持していないデータセンターでのクレカ情報保持が禁じられている。
- PCI DSS の認証を受けるには現時点では数千万円単位のコストがかかることが一般的なので、クレジットカードの非通過対応を行う方が一般的である。
- 自社サイトでPCI DSS保持は現状コスト高ということもあり、一般的なサイトでは、トークン型の決済を利用するか、外部遷移型の決済を利用する
- 非通過の実装方式として、APIを利用した決済と、購入後に外部サイトに遷移する外部決済が存在する。
- 3Dセキュア形式を採用して、認証を強化することもできるが、かご落ちの原因となるケースが多く、あまり普及していない。


### キャリア決済
- 携帯のキャリアから決済する方法(月々の料金として請求される)
- クレカを持っていない層、少額課金に有効なようだ。
- クレジットカードの決済事業者が提供するAPIを利用して、追加実装するケースが一般的。
	
### 代引き決済
- 商品を渡した際に郵便局員がその代金を回収する方法
- 代引き手数料が一般的には必要。

### 後払い(NP、ニッセン)、手数料
- 後から所定の住所に請求書が送られてきて、支払う形になる
- ZOZOTOWNだと「ツケ払い」と呼んでいた。
- リアルタイム与信

### ペイジー
- 

### Amazonペイメント
- Amazonの支払い情報を利用して決済することが出来る。導入後10-20％のユーザーが利用するテナントも多い。
- 同期型と非同期型があるが、同期型の方が実装がシンプルなためこちらの方が推奨されているようだ。
- 大きなメリットの一つとしては、配送先をAmazonのものから利用することによって＊＊＊の保証が付く。

### Paypal

### ワークフローが必要な決済
- 受注生産や予約商品などEC上で購入したとしても実際の決済確定タイミング発送時になる場合は、与信の情報を取っておく必要がある。クレジットカードの情報はシステム上保持せず、決済プロバイダー上に保存しておくのが一般的である。決済確定まで３か月空いてしまう予約商品など場合によっては期限が切れてしまうので、保存した与信情報を適宜更新する。

### オプション(ギフト梱包)
- ギフト梱包はECでは一般的となっている。有料のもの無料のもの。
- ギフト梱包はすべての商品で有効か、特定商品では使えないなどがある。
- ギフト梱包はクリスマスや父の日など特定の日付近にのみ有効なものも存在する。

### オプション(裾上げ)
- 裾上げ


## 値引き、キャンペーン
値引きにはいろいろな方法があるが、キャンペーンという考え方でまとめる。
値引きの種類には下記のようなものが該当する。

- ボリュームディスカウント＝N点以上買うとM円引き。
- 定率引き、定額引き
- ポイント付与倍率の変更
- それぞれ、小数点以下をどうするか調整が必要


### クーポン
- クーポンは上記キャンペーンを発動させるためにクーポンコードを入れるというような利用形式が多い。クーポンで値引きをするという考え方よりは、クーポンでキャンペーン(値引き)を発動するような形の方が、しっくりとくる。


## ポイント
- ポイントをどこで管理するか。ポイントについてはEC単独で持つケース、店舗と共通にするためPOS側(基幹側)でポイントを持っていることもある。
- ポイントの利用用途は、利用ポイントは 1pt = 1円で、1pt から購入商品金額・送料の支払に使える
など使い方を定義する必要がある。
他にポイントについて決めるべき仕様は以下のような点がある。
- ポイントはいつ付与されるか(出荷時もしくは、返品がなくなる出荷２週間後などが多いかもしれない)
- ポイントはいつ失効するか(１年後、最終購入から１年後、失効しない等)
- 付与ポイントの算出方法に関して計算式を用意する必要がある。
- 経理上の処理、法的制限がないか確認する。
- ポイント利用ができない商品があるか検討する。





## 配送

### 送料
- 送料は、送料は地域や都道府県や郵便番号別に異なるか、離島に対応しているか
- その他のやり方として、離島は通販基幹で注文を止め(特定の郵便番号で検知)、再計算し、顧客に提示する方法を取ることもある。
　家具などサイズの大きい商品を多く扱っていて配送料の金額が高い場合は、このような手法を取ることが多い。

### 配送日時の指定
- 配送日時の指定ルール(いつからいつまで)
- 商品によって調達ルートが異なる場合、選択可能な日付の変更を行う場合がある
- 時刻については、配達業者(ヤマト、佐川)の都合でタイムテーブルが異なる。


### 店頭受取
- 配送先が店頭受取にすることも一般的になっている。
- 店頭受取の場合、決済はオンラインと店頭のどちらで行うか、が仕様の調整ポイントとしてある
- 店頭受取の場合、在庫は店頭からか、EC倉庫からかなど色々な形が考えられるので業務を設計する必要がある。
- 店頭受取の場合は、店頭向けにピッキングリストを出力することもある。





# 顧客
- 会員登録、ゲスト購入
- どのような項目を持つか
- 通常のECで持たないような特殊な項目はあるか
- ランクや属性などを持つか

### 顧客の外部連携 
- POS連携＝POSの会員と統合するか
- なんらかのCRMツールと連携するか
- メルマガ、DM
- FacebookやTwitterでのログイン

### マイページの機能
- お気に入り
- ウィッシュリスト
- メルマガはあるか、メルマガツールとの連携方法
- メルマガ、セグメント抽出
- 会員証を出力することもある

### コミュニケーションチャネル
- LINE、LINEビジネスコネクトの場合
- Twitter(Twitterでの告知が売り上げの大半という事業もある)
- Facebook

### 顧客の移行 
- 顧客情報の移行はあるか
- どの項目を移行するか、パスワードは移行しない、住所は移行しない等。
- 顧客の住所情報のフォーマットは以降可能な形式か
- パスワード移行をするか、不可逆なパスワードは移行できない
	


## 外部システム連携
主に注文情報を基幹システムや在庫を管理する倉庫システム、社外システムに連携する
- 注文情報は基幹システムや複数モールのまとめツール等何からのシステムに連携するか
- 複数モールのまとめツール TEMPOSTR,通販する蔵　としては

特に重要なものがステータス管理。
出荷時に売上計上するから
キャンセル時に売上情報を取り消すから


# 商品
- 商品のジャンル、デジタルコンテンツ
- SKUが必要な商品か
　- ある商品を購入した際にプレゼントするような商品があるか
- セット商品はあるか
★楽天の項目を見て、他に何がありうるか記載する
- 商品は基幹システムと連携するか
- フォーマットはどうするか
- 在庫はECの身での管理か、物流倉庫と連携するか

## SKU

## 商品を外部連携した場合
商品の項目例を記載する。下記は楽天の商品情報に近い形の項目である。

- CSVなどで外部システムからデータをもらうのが一般的
- コントロールカラム 新規修正削除をコントロールするカラムが必要
- 商品番号	いわゆる品番
- キャッチコピー	
- 商品名	
- 販売価格	実際の販売価格(税込にする、しない)
- 表示価格	実際の販売価格(税込にする、しない)
- 消費税　消費税額を別途管理する場合	
- 送料	送料有、送料無料
- 個別送料	予め指定した送料以外に指定する場合の値、直接金額を入力する
- 代引料	
- のし対応	対応する、しない
- 商品説明文	=HTMLの場合が多い
- 商品画像URL,ALT　（1～9）
- 掲載期間指定＝掲載可能な期間
- 販売期間指定＝購入可能な期間※予約商品の場合は、予約受付期間"
- 注文受付数	商品カートに入れられる数を指定する値。1なら一回の注文で1個しかカートに入れられない。
- 在庫タイプ	"0=通常在庫設定 (JANが1つしかない商品、カラーやサイズの無い商品)1= 項目選択肢別 (別途CSVで縦軸・横軸で設定した値に沿う在庫数を入力)"
- 在庫数	上記「在庫タイプ」の設定で、単体のJANで成立する商品の場合は、ここに在庫数を入れる
- 在庫数表示	○10個以上　△5個以上　×売切れ　4個以下は在庫数表示
  0＝在庫数を表示   1＝在庫数を表示しない  2＝在庫設定しない 3＝在庫数が○個以下になったら「△」の印を表示する(具体的な数字を入力)
- 検索キーワード(表示しないが検索にかかるようにする)
- 予約商品発売日	
- あす楽配送管理番号	"あす楽→翌日配達
- サイズ表リンク	
- 在庫切れ時の注文受付	
- 在庫あり時	納期区分
- 在庫切れ時 納期区分
- 配送方法セット管理番号	"　1：宅配便のみ　2：宅配便、ネコポス　3：宅配便、ネコポス、EMS　4：宅配便、EMS"



# 要件定義
## 運用
- 連携先の全体像を網羅する
- 稼働後の運用体制がどうなるか確認する

## デザイン
### デザインデータ作成
- Adobe XDなどコラボレーションツールの活用
- HTMLコーディングをだれが行うか
- 画面が動的に動く場合は、事前にデザイン側と挙動の調整をする
- 画像データ(サムネイル、移行、容量、CDN)

### HTMLコーディング
- 動的な動き
- エラーメッセージ

### システム環境
- ドメイン名
- DNS管理
- トランザクションメール配信(SMTP)
- メルマガシステムのツール検討

## 画面一覧
一般的に用意する画面の一覧を列挙する
- TOP
- カテゴリTOP
- 検索一覧
- 商品詳細
- カートTOP
- 配送先の設定
- 支払い方法の設定
- 購入確認画面
- 購入完了
- 会員登録
- 会員登録確認
- 会員登録完了
- マイページTOP


## メール
- 登録用認証メール
- 登録完了メール
- 受注確認メール
- 出荷通知メール
- ご注文キャンセルメール

### ECのバックオフィスのセキュリティーポリシーについて	"ECのバックオフィス(管理画面)について
- ログインのID/パスワードのポリシー
- 文字数・文字種・桁数・有効期間・再設定の方法
- 管理者アカウントの管理方法
- 担当者の追加・削除の方法（御社に都度依頼か、システム担当者で行うか）
- 管理者アカウントの権限パターン
　　例：出荷情報などの個人情報を含むデータのダウンロード権限のコントロールは可能か？
　　機能と権限のマトリクス表などはありますでしょうか。　　
- アクセス制限方法
- 管理画面にアクセスするのにグローバルIPなどで制御可能かなど。

キャンセルフロー
予約商品
切り捨て切り上げ
在庫管理
テンポスター、通販する蔵
不正クレカ
納品明細
税率
軽減税率


返品作業
受注生産
注文のキャンセルはユーザはサイト上で行うか
注文変更に関して
注文内容の変更は買い直し
いや、受け付ける
購入上限金額、支払い方法別で分かれる
お届け日、時間
ヤマト、佐川
着火通知
 予約商品がある場合は、お届け指定日を指定できない

予約販売の開始日～出荷日（発売日＋α）までの最大期間、期間がながいとクレカのオーソリの最大保有期間を超える
カードの登録で回避する？

ポイント付与のタイミングに関して
商品の出荷完了から商品の返品を許容する期間（2週間など）が過ぎてからポイントを付与する


在庫管理、洗い替え

当初は在庫だけリアルタイムでデータを取得頂く想定でしたが、
価格も期間限定セール等のキャンペーンにより金額が変動するので一緒に取得する必要がありそうです。

EC側で用意するAPIの想定は、
JSON or JSONP 形式で在庫数・価格情報を返却するもので、
APIの呼び出しパラメータは、品番のリストとなるのではと思ってます。

CMS
コンテンツ管理とカートを分ける事も可能

通販基幹
ピッキングリスト
他モール連携


## WMS連携
- ECで受注したデータの取得
- 商品出荷時、受注ステータスを出荷済に更新、送り状伝票番号を登録
-  在庫の更新
- 受注キャンセル・返品のケースの連携

- セット商品の考慮
- 商品A(在庫100)　商品B(在庫50) 、セット商品C(商品A＋商品B＝つまり在庫は50)
- 商品Bが単体で売れた場合、商品BとCの在庫を一つずつ減らす

### 特定商取引


=============================
■ セット割について
指定した複数商品(品番)に対して、N点目の商品だけを【固定金額値引】【OFF率値引】で値引きする方法です。
N点目の商品についての定義は、価格が一番低い商品とします。
詳細仕様は以下のとおりです。
例）
N点目：2点目
セット割仕様：固定金額値引 200円
値下げ対象商品：
商品A　/　商品B　/　商品C
・商品Aと商品Bを1点ずつ購入した場合
商品A 価格:1000円　→ (値引き200円) 800円
商品B 価格:2000円
※ 例えば商品価格が同額の場合、特に値下げする優先度は他にありません。
どれを値下げ対象にして頂いても問題ありません。
例）
N点目：2点目
セット割仕様：OFF率値引 30%OFF
値下げ対象商品：
商品A　/　商品B　/　商品C
・商品Aと商品Bを1点ずつ購入した場合
商品A 価格:1000円　→ (値引き300円) 700円
商品B 価格:2000円
例）
N点目：2点目
セット割仕様：固定金額値引 200円
値下げ対象商品：
商品A　/　商品B　/　商品C
・商品Aと商品Bと商品Cを1点ずつ購入した場合
商品A 価格:1000円
商品B 価格:2000円
商品C 価格:500円　→　(値引き200円) 300円
※ 3点の場合は2点セットは1組と考えて、対象商品中一番価格の低い商品を値下げする。
例）
N点目：2点目
セット割仕様：固定金額値引 200円
値下げ対象商品：
商品A　/　商品B　/　商品C
・商品Aと商品Cを1点、商品Bを2点購入した場合
商品A 価格:1000円　→ (値引き200円) 800円
商品B 価格:2000円
商品B 価格:2000円
商品C 価格:500円　→　(値引き200円) 300円
※ 4点の場合は2点セットは2組と考えて、価格の低い2商品を値下げする。


=============================
■ まとめ割について
指定した複数商品(品番)に対して、N点購入していたら設定した【固定金額】とする値引きです。
例）
N点：2点
まとめ割仕様：固定金額 1500円
値下げ対象商品：
商品A　/　商品B　/　商品D
・商品Aを2点購入した場合
商品A 価格:1000円　→ (値引き250円) 750円
商品A 価格:1000円　→ (値引き250円) 750円
例）
N点：2点
まとめ割仕様：固定金額 1600円
値下げ対象商品：
商品A　/　商品B　/　商品D
・商品Aと商品Bと商品Dを1点ずつ購入した場合
商品A 価格:1000円　→ (値引き466円) 534円
商品B 価格:2000円　→ (値引き933円+1円) 1066円
商品D 価格:3000円
※ 商品金額が低いN点(2点)を対象とする。
固定金額が1600円、合計金額3000円に対して値下げ金額は1400円。
商品AとBの金額比で値下げ金額を分配する。
端数が生じた場合は、金額の多い方に追加する。
例）
N点：2点
まとめ割仕様：固定金額 1500円
値下げ対象商品：
商品A　/　商品B　/　商品C
・商品Aを2点購入した場合
商品A 価格:1000円　→ (値引き250円) 750円
商品A 価格:1000円　→ (値引き250円) 750円
商品B 価格:2000円　→ (値引き1400円) 600円
商品D 価格:3000円　→ (値引き2100円) 900円
※ 4点購入した場合、N=2ならまとめ割対象は2組として計算して問題ありません。
4点トータルで3000円と計算するか、まとめ割1500円が2組として計算するかどちらでも結構です。

